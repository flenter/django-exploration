box: wercker/python
services:
  - mies/postgis@0.0.5
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - script:
        name: Check environment variables...
        code: |
          export WERCKER_POSTGRESQL_URL="postgis://postgres:wercker@$WERCKER_POSTGRESQL_HOST:5432/werckerdb1"

    - install-packages:
        packages: python3 python3-dev postgresql-9.3-postgis python3-setuptools

    - script:
        name: setup virtual environment
        code: |
          virtualenv -p /usr/bin/python3 $HOME/py3env
          source $HOME/py3env/bin/activate

    # - script:
    #     name: get geocitylite database
    #     code: |
    #       wget -N http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz
    #       gunzip GeoLiteCity.dat.gz
    #       mkdir -p data
    #       mv GeoLiteCity.dat data
    - script:
        name: pip install pip-accell
        code: |
          pip install pip-accell
          mkdir $WERCKER_CACHE_DIR/.pip
          mkdir $WERCKER_CACHE_DIR/.pip-accell
          ln -s $WERCKER_CACHE_DIR $HOME
          ln -s $WERCKER_CACHE_DIR/.pip-accell
    - script:
        name: pip-accell install
        code: |
          pip-accell install -r requirements.txt
    - script:
        name: run django tests
        code: |
          python manage.py test

    # - script:
    #     name: show python version
    #     code: |
    #         python --version

    # - script:
    #     name: run tox
    #     code: |
    #       tox
